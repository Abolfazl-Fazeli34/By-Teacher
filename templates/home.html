{% load static %}
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>معلمان برتر</title>

  <!-- بوت استرپ CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <!-- فونت فارسی Vazirmatn -->
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn&display=swap" rel="stylesheet">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
  <!-- بوت استرپ JS و وابستگی‌ها -->


  <style>
    body {
      font-family: 'Vazirmatn', sans-serif;
      background: #121212;
      color: #fff;
      padding: 2rem;
      margin: 1rem;
    }

    h1 {
      font-size: 2.5rem;
      font-weight: bold;
      color: #f9a826;
    }

    .podium {
      display: flex;
      justify-content: center;
      align-items: flex-end;
      gap: 2rem;
      margin-bottom: 3rem;
    }

    .podium .position {
      background-color: #1e1e1e;
      border-radius: 1.5rem;
      padding: 2rem;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
      transition: transform 0.3s ease;
      position: relative;
    }

    .podium .position:hover {
      transform: translateY(-10px);
    }

    .first {
      height: 250px;
      background: linear-gradient(135deg, #f9a826, #f18a00);
    }

    .second {
      height: 200px;
      background: linear-gradient(135deg, #6c757d, #495057);
    }

    .third {
      height: 180px;
      background: linear-gradient(135deg, #b76e31, #ffb84d);
    }

    .teacher-name {
      font-size: 1.4rem;
      font-weight: bold;
      margin-top: 1.5rem;
    }

    .vote-count {
      font-size: 1rem;
      color: #ccc;
    }

    .teacher-list {
      background-color: #222;
      border-radius: 1.5rem;
      padding: 1.5rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .table {
      background-color: #333;
      border-radius: 1rem;
    }

    .table th, .table td {
      color: #fff;
    }

    .vote-btn {
      background: linear-gradient(135deg, #007bff, #00c6ff);
      color: white;
      border: none;
      padding: 1rem 3rem;
      border-radius: 2rem;
      font-size: 1.2rem;
      font-weight: bold;
      transition: background 0.3s ease;
      margin-top: 2rem;
    }

    .vote-btn:hover {
      background: linear-gradient(135deg, #0056b3, #0099cc);
    }

    .medal-icon {
      font-size: 3rem;
      position: absolute;
      top: -40px;
      left: 50%;
      transform: translateX(-50%);
    }

    footer {
      text-align: center;
      margin-top: 3rem;
      font-size: 1rem;
      color: #888;
    }

    .teacher-list .table {
      background-color: #181818;  /* پس‌زمینه تیره‌تر */
      color: #fff;  /* متن روشن */
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
      transition: transform 0.3s ease;
    }

    /* هر ردیف فرد کمی تیره‌تر از ردیف‌های زوج */
    .teacher-list .table-striped tbody tr:nth-child(odd) {
      background-color: #1d1d1d;  /* ردیف‌های فرد */
    }

    .teacher-list .table-striped tbody tr:nth-child(even) {
      background-color: #454545;  /* ردیف‌های زوج */
    }

    /* وقتی روی ردیف هاور می‌شود، رنگ روشن‌تر می‌شود */
    .teacher-list .table-hover tbody tr:hover {
      background-color: #787878 !important;  /* رنگ روشن‌تر برای هاور */
    }

    /* مرزهای سلول‌ها */
    .table-bordered th, .table-bordered td {
      border: 1px solid #444;  /* مرز تیره */
    }

    .table-dark th {
      background-color: #1c1c1c;  /* پس‌زمینه تیره هدر */
      color: #fff;
    }

    .table th, .table td {
      font-size: 1.1rem;
      font-weight: 500;
      padding: 1rem;
    }

    .table th {
      background-color: #2c2c2c;  /* هدر با پس‌زمینه تیره */
      color: #fff;
    }

    .table td {
      background-color: #333;  /* پس‌زمینه سلول‌ها */
    }
    td:hover{
      background-color: rgb(124, 124, 124);
    }
    /* پایه‌های طراحی */
/* پایه‌های طراحی */
.podium {
  display: flex;
  justify-content: center;
  align-items: flex-end;
  gap: 40px;
  margin-top: 50px;
  position: relative;
}

/* طراحی موقعیت‌ها */
.position {
  position: relative;
  text-align: center;
  background-color: #333;
  padding: 40px 20px;
  border-radius: 15px;
  box-shadow: 0 15px 40px rgba(0, 0, 0, 0.6);
  transition: transform 0.4s ease, box-shadow 0.4s ease, opacity 0.3s ease-in-out;
  overflow: hidden;
  opacity: 0.95;
  z-index: 1;
  transform: translateY(20px);
}

/* ایجاد سایه‌های عمق‌دار */
.position:hover {
  transform: translateY(-20px) scale(1.05);
  box-shadow: 0 25px 55px rgba(0, 0, 0, 0.7);
  opacity: 1;
}

/* انیمیشن‌های مدال‌های قهرمانی */
.position.first {
  background: linear-gradient(135deg, #ffd700, #ffcc00);
  animation: shine-gold 2s infinite alternate;
}

.position.second {
  background: linear-gradient(135deg, #c0c0c0, #a8a8a8);
  animation: shine-silver 2s infinite alternate;
}

.position.third {
  background: linear-gradient(135deg, #cd7f32, #a97c53);
  animation: shine-bronze 2s infinite alternate;
}

/* طراحی مدال‌ها */
.medal-icon {
  font-size: 5rem;
  margin-bottom: 15px;
  animation: pulse 1.5s ease-in-out infinite;
  text-shadow: 0 3px 8px rgba(0, 0, 0, 0.4);
}

/* اسامی و تعداد رأی */
.teacher-name {
  font-size: 1.6rem;
  font-weight: bold;
  color: #fff;
  margin-bottom: 10px;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.vote-count {
  font-size: 1.2rem;
  color: #ddd;
  text-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
}

/* انیمیشن برای درخشش */
@keyframes shine-gold {
  0% {
    background: linear-gradient(135deg, #ffd700, #ffcc00);
  }
  100% {
    background: linear-gradient(135deg, #f1c27d, #ffd700);
  }
}

@keyframes shine-silver {
  0% {
    background: linear-gradient(135deg, #c0c0c0, #a8a8a8);
  }
  100% {
    background: linear-gradient(135deg, #d8d8d8, #c0c0c0);
  }
}

@keyframes shine-bronze {
  0% {
    background: linear-gradient(135deg, #cd7f32, #a97c53);
  }
  100% {
    background: linear-gradient(135deg, #c6895b, #b37f3f);
  }
}

/* انیمیشن پالس برای مدال‌ها */
@keyframes pulse {
  0% {
    transform: scale(1);
    opacity: 1;
  }
  50% {
    transform: scale(1.1);
    opacity: 0.8;
  }
  100% {
    transform: scale(1);
    opacity: 1;
  }
}

/* افزودن سایه‌های پشتی به موقعیت‌ها */
.position.first::after,
.position.second::after,
.position.third::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.2);
  border-radius: 15px;
  z-index: -1;
}



/* افکت چرخش مدال‌ها */
@keyframes rotate-medal {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}
.title {
  font-size: 4rem;
  font-weight: bold;
  background: linear-gradient(135deg, #ff6600, #ffcc00, #ff3399);
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  text-transform: uppercase;
  letter-spacing: 5px;
  position: relative;
  animation: glow-text 3s ease-in-out infinite;
}

@keyframes glow-text {
  0% {
    text-shadow: 0 0 20px rgba(255, 102, 0, 0.8), 0 0 30px rgba(255, 102, 0, 0.6);
  }
  50% {
    text-shadow: 0 0 30px rgba(255, 204, 0, 1), 0 0 40px rgba(255, 204, 0, 0.8);
  }
  100% {
    text-shadow: 0 0 20px rgba(255, 102, 0, 0.8), 0 0 30px rgba(255, 102, 0, 0.6);
  }
}

@keyframes spin-icon {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}
/* دکمه رأی */
.btn-vote {
  background-color: #4caf50;
  color: white;
  padding: 12px 25px;
  border: none;
  border-radius: 10px;
  font-size: 1rem;
  cursor: pointer;
  transition: background 0.3s ease;
}

.btn-vote:hover {
  background-color: #45a049;
}

/* مودال پس‌زمینه */
.modal-vote {
  display: none;
  position: fixed;
  z-index: 999;
  padding-top: 80px;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.8);
  animation: fadeIn 0.4s ease-out;
}

/* محتوا */
.modal-content {
  background-color: #1f1f1f;
  margin: auto;
  padding: 30px;
  border-radius: 15px;
  width: 90%;
  max-width: 500px;
  color: white;
  animation: slideUp 0.4s ease;
  box-shadow: 0 6px 20px rgba(0,0,0,0.9);
}

/* انیمیشن‌ها */
@keyframes fadeIn {
  from {opacity: 0}
  to {opacity: 1}
}

@keyframes slideUp {
  from {transform: translateY(30px); opacity: 0}
  to {transform: translateY(0); opacity: 1}
}

/* دکمه بستن */
.modal-content .close {
  color: #bbb;
  float: left;
  font-size: 28px;
  font-weight: bold;
  cursor: pointer;
}

.modal-content .close:hover {
  color: white;
}

/* فرم */
#voteForm {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

#voteForm label {
  font-weight: bold;
}

#voteForm select {
  padding: 10px;
  border-radius: 8px;
  background-color: #2a2a2a;
  color: white;
  border: 1px solid #444;
}

#voteForm button[type="submit"] {
  background-color: #2196f3;
  color: white;
  border: none;
  padding: 10px;
  border-radius: 10px;
  cursor: pointer;
  transition: background 0.3s ease;
}

#voteForm button[type="submit"]:hover {
  background-color: #1976d2;
}

/* واکنش‌گرا */
@media (max-width: 576px) {
  .modal-content {
    width: 95%;
    padding: 20px;
  }

  .btn-vote {
    width: 100%;
    font-size: 1rem;
  }
}
/* دکمه اسکرول به پایین */
.scroll-down-btn {
  position: fixed;
  left: 20px;
  top: 20px;
  background-color: red;
  border-radius: 50%;
  padding: 10px;
  color: white;
  text-decoration: none;
  z-index: 1000;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  transition: background-color 0.3s ease;
}
.scroll-down-btn:hover {
  background-color: darkred;
}

/* دکمه ورود/خروج */
.auth-btn-container {
  position: fixed;
  top: 15px;
  right: 15px;
  z-index: 1000;
}

.login-btn,
.logout-btn {
  background-color: #002aff;
  color: white;
  padding: 8px 16px;
  border-radius: 6px;
  text-decoration: none;
  border: none;
  cursor: pointer;
  font-size: 14px;
  transition: background-color 0.3s ease;
}

.login-btn:hover,
.logout-btn:hover {
  background-color: #001fbd;
}

/* تیتر صفحه */
.title {
  font-size: 2.2rem;
  font-weight: bold;
  text-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

/* واکنش‌گرایی برای موبایل */
@media (max-width: 576px) {
  .scroll-down-btn {
    left: 15px;
    padding: 8px;
  }

  .auth-btn-container {
    top: 10px;
    right: 10px;
  }

  .login-btn,
  .logout-btn {
    padding: 6px 12px;
    font-size: 13px;
  }

  .title {
    font-size: 1.6rem;
  }
}

    @media (max-width: 768px) {
  .podium {
    flex-direction: column;
    align-items: center;
  }

  .position {
    width: 100%;
    max-width: 300px;
    margin-bottom: 2rem;
  }

  .title {
    font-size: 2rem;
    letter-spacing: 2px;
    text-align: center;
  }

  .vote-btn {
    width: 100%;
    padding: 0.8rem 1.5rem;
    font-size: 1rem;
  }

  .table th, .table td {
    font-size: 0.9rem;
    padding: 0.5rem;
  }

  body {
    padding: 1rem;
    margin: 0.5rem;
  }
}
<style>
.modal-overlay {
  display: none;
  position: fixed;
  z-index: 1000;
  right: 0;
  top: 0;
  width: 100%;
  height: 100%;
  backdrop-filter: blur(6px);
  background-color: rgba(0, 0, 0, 0.4);
  animation: fadeIn 0.3s ease-in-out;
}

.modal-content {
  background: #fff;
  margin: 8% auto;
  padding: 30px;
  border-radius: 16px;
  max-width: 600px;
  position: relative;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
  text-align: right;
  direction: rtl;
  font-family: "Vazirmatn", sans-serif;
}

.close-btn {
  position: absolute;
  top: 12px;
  left: 20px;
  font-size: 28px;
  cursor: pointer;
  color: #666;
  transition: color 0.3s;
}
.close-btn:hover {
  color: #e74c3c;
}

.open-conditions-btn {
  padding: 10px 18px;
  font-size: 16px;
  border: none;
  border-radius: 10px;
  background-color: #2f80ed;
  color: #fff;
  cursor: pointer;
  transition: background 0.3s ease;
}
.open-conditions-btn:hover {
  background-color: #1c60bd;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.custom-dark-modal {
  background: #111;
  border: 1px solid #2a2a2a;
  box-shadow: 0 0 40px rgba(255, 255, 255, 0.05);
  animation: fadeInUp 0.5s ease-out;
}

@keyframes fadeInUp {
  from {
    transform: translateY(20px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}
/* پس‌زمینه نیمه شفاف بسیار تیره */
  #voteModal {
    display: none; /* پیش‌فرض مخفی */
    position: fixed;
    z-index: 1050;
    left: 0; top: 0;
    width: 100%; height: 100%;
    background: rgba(10, 10, 10, 0.9);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Vazirmatn', sans-serif;
  }

  /* محتوای مودال - زمینه مشکی مات با سایه */
  #voteModal .modal-content {
    background: linear-gradient(145deg, #0a0a0a, #1a1a1a);
    border-radius: 20px;
    box-shadow: 0 0 30px 3px rgba(255,255,255,0.05);
    padding: 30px 40px;
    width: 400px;
    max-width: 90%;
    color: #eee;
    position: relative;
    border: 1px solid #333;
  }

  /* دکمه بستن بزرگ و سفید */
  #voteModal .close {
    position: absolute;
    top: 15px; right: 20px;
    font-size: 28px;
    font-weight: bold;
    color: #eee;
    cursor: pointer;
    transition: color 0.3s ease;
    user-select: none;
  }
  #voteModal .close:hover {
    color: #ff4c60;
  }

  /* برچسب و نوشته‌ها */
  #voteModal label {
    display: block;
    margin-bottom: 12px;
    font-size: 17px;
    font-weight: 600;
    color: #f0f0f0;
    text-align: right;
  }

  /* سِلکت چند انتخابی */
  #voteModal select[multiple] {
    width: 100%;
    height: 110px;
    background: #121212;
    border: 1.5px solid #444;
    border-radius: 12px;
    color: #ddd;
    padding: 10px;
    font-size: 15px;
    direction: rtl;
    outline: none;
    transition: border-color 0.3s ease;
  }
  #voteModal select[multiple]:focus {
    border-color: #ff4c60;
    box-shadow: 0 0 8px #ff4c60;
    background: #1a1a1a;
  }

  /* پاراگراف‌های نکته و وضعیت رأی‌ها */
  #voteModal p {
    font-size: 14px;
    color: #bbb;
    margin: 15px 0;
    text-align: right;
  }
  #voteModal p b {
    color: #ff4c60;
  }

  /* دکمه ثبت رأی */
  #voteModal .vote-btn-hop {
    background: linear-gradient(45deg, #ff3a5c, #ff6a88);
    border: none;
    border-radius: 30px;
    padding: 12px 30px;
    color: #fff;
    font-weight: 700;
    font-size: 16px;
    width: 100%;
    cursor: pointer;
    box-shadow: 0 6px 12px rgba(255, 58, 92, 0.5);
    transition: all 0.3s ease;
    user-select: none;
  }
  #voteModal .vote-btn-hop:hover {
    box-shadow: 0 8px 20px rgba(255, 58, 92, 0.8);
    transform: translateY(-3px);
    background: linear-gradient(45deg, #ff1c3d, #ff4c60);
  }
  #voteModal .vote-btn-hop:active {
    transform: translateY(0);
    box-shadow: 0 4px 10px rgba(255, 58, 92, 0.6);
  }

</style>
<head>
     <style>

/* استایل تایمر کلی */
#countdown {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 1.5rem;
  font-family: 'Vazirmatn', sans-serif;
  font-weight: 700;
  font-size: 3rem;
  color: #f9a826; /* رنگ زرد طلایی هماهنگ با هدرها */
  background-color: #1e1e1e;
  padding: 1rem 2rem;
  border-radius: 1.5rem;
  box-shadow: 0 6px 20px rgba(249, 168, 38, 0.5);
  user-select: none;
  width: max-content;
  margin: 2rem auto;
}


  </style>
</head>
<body>
  <div class="container text-center">
    <!-- تایمر -->
    <div id="countdownContainer">
      <div id="countdown">00:00:00</div>
    </div>
    <br>
    <br>

    <!-- دکمه اسکرول -->
    <a href="#ra" class="scroll-down-btn"></a>

    <!-- ورود/خروج -->
    <div class="auth-btn-container">
      {% if not user.is_authenticated %}
        <a href="{% url 'login' %}" class="login-btn">ورود</a>
      {% else %}
        <form method="post">
          {% csrf_token %}
          <button type="submit" name="logout" value="1" class="logout-btn">خروج</button>
        </form>
      {% endif %}
    </div>

    <!-- تیتر -->
    <h1 style="font-size: 5rem" class="mb-5 text-center text-white title">معلمان برتر</h1>

    <!-- سکوی قهرمانی -->
    <div class="podium row text-center">
      {% if top_teachers|length > 2 %}
        <div class="position third col-12 col-md-3 order-md-1 order-3">
          <div class="medal-icon">🥉</div>
          <div class="teacher-name">{{ top_teachers.2.name }}</div>
          <div class="vote-count hidden" id="vote3">{{ top_teachers.2.vote }} رأی</div>
        </div>
      {% endif %}
      {% if top_teachers|length > 0 %}
        <div class="position first col-12 col-md-3 order-md-2 order-1">
          <div class="medal-icon">🥇</div>
          <div class="teacher-name">{{ top_teachers.0.name }}</div>
          <div class="vote-count hidden" id="vote1">{{ top_teachers.0.vote }} رأی</div>
        </div>
      {% endif %}
      {% if top_teachers|length > 1 %}
        <div class="position second col-12 col-md-3 order-md-3 order-2">
          <div class="medal-icon">🥈</div>
          <div class="teacher-name">{{ top_teachers.1.name }}</div>
          <div class="vote-count hidden" id="vote2">{{ top_teachers.1.vote }} رأی</div>
        </div>
      {% endif %}
    </div>

    <!-- جدول رتبه بندی -->
    <div class="teacher-list table-responsive hidden" id="teacherTable" style="margin-top: 80px;">
      <table class="table table-hover table-striped table-bordered text-center align-middle">
        <thead class="table-dark">
          <tr>
            <th>#</th>
            <th>نام معلم</th>
            <th>تعداد رأی</th>
            <th>عملیات</th>
          </tr>
        </thead>
        <tbody>
          {% for teacher in all_teachers %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ teacher.name }}</td>
            <td>{{ teacher.vote }}</td>
            <td>
              {% if teacher.id in voted_teacher_ids %}
              <form method="post" style="display:inline;">
                {% csrf_token %}
                <button type="submit" name="delete_vote" value="{{ teacher.id }}" class="btn btn-sm btn-danger">حذف رأی</button>
              </form>
              {% else %} - {% endif %}
            </td>
          </tr>
          {% empty %}
          <tr><td colspan="4">هیچ معلمی ثبت نشده است.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
<!-- جدول معلم‌هایی که کاربر بهشون رأی داده -->
<div class="teacher-list table-responsive" id="userVotedTeachersTable" style="margin-top: 80px;">
  <table class="table table-hover table-striped table-bordered text-center align-middle">
    <thead class="table-dark">
      <tr>
        <th>نام معلم</th>
        <th>عملیات</th>
      </tr>
    </thead>
    <tbody>
      {% with 0 as count %}
      {% for teacher in all_teachers %}
        {% if teacher.id in voted_teacher_ids %}
          {% with count|add:"1" as count %}
          <tr>
            <td>{{ teacher.name }}</td>
            <td>
              <form method="post" style="display:inline;">
                {% csrf_token %}
                <button type="submit" name="delete_vote" value="{{ teacher.id }}" class="btn btn-sm btn-danger">حذف رأی</button>
              </form>
            </td>
          </tr>
          {% endwith %}
        {% endif %}
      {% empty %}
        <tr><td colspan="4">شما هنوز به هیچ معلمی رأی نداده‌اید.</td></tr>
      {% endfor %}
      {% endwith %}
    </tbody>
  </table>
</div>



    <!-- دکمه رأی دادن -->
    <button id="ra" class="vote-btn" style="margin-top: 4rem;" onclick="openVoteModal()">🗳️ رأی دادن به معلم</button>

    <!-- مودال رأی -->
    <div id="voteModal" class="modal-vote" style="display:none;" dir="rtl">
      <div class="modal-content">
        <span class="close" onclick="closeVoteModal()">&times;</span>
        <form id="voteForm" method="post" action="{% url 'home' %}">
          {% csrf_token %}
          <label for="teacherSelect">انتخاب معلم:</label>
          <select id="teacherSelect" name="teachers" multiple required>
            {% for teacher in teachers %}
              <option value="{{ teacher.id }}">{{ teacher.name }}</option>
            {% endfor %}
          </select>
          <p><b>نکته:</b> حداکثر سه رأی</p>
          <p>شما تا کنون <b>{{ votes_count }}</b> رأی داده‌اید. باقی‌مانده: <b>{{ votes_left }}</b></p>
          <button class="vote-btn-hop" type="submit">ثبت رأی</button>
        </form>
      </div>
    </div>

    <br><br>

    <!-- دکمه شرایط رأی‌دهی -->
    <button type="button" class="btn btn-primary rounded-pill px-4 py-2 shadow" data-bs-toggle="modal" data-bs-target="#conditionsModal">
      📜 شرایط رأی‌دهی
    </button>

    <!-- مودال شرایط رأی‌دهی -->
    <div class="modal fade" id="conditionsModal" tabindex="-1" aria-labelledby="conditionsModalLabel" aria-hidden="true" dir="rtl">
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content rounded-4 border-0 bg-dark text-white shadow-lg custom-dark-modal">
          <div class="modal-header border-0 rounded-top-4" style="background: linear-gradient(90deg, #222, #111);">
            <h5 class="modal-title fw-bold" id="conditionsModalLabel">🧾 شرایط رأی‌دهی به معلمان برتر</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="بستن"></button>
          </div>
          <div class="modal-body px-4 py-3" style="font-family: 'Vazirmatn', sans-serif; max-height: 80vh; overflow-y: auto;">
            <p class="mb-3">
              این بخش با هدف <strong class="text-warning">ارزیابی محبوبیت معلمان</strong> طراحی شده است.
              <br>تمامی آرا در فضایی محترمانه و سازنده جمع‌آوری می‌شوند.
            </p>
            <ul class="list-group list-group-flush mb-3">
              <li class="list-group-item bg-transparent text-light border-0"><i class="bi bi-shield-check text-success ms-2"></i> این رأی‌گیری <strong>هیچ‌گونه جنبه توهین‌آمیز یا تمسخرآمیز</strong> ندارد.</li>
              <li class="list-group-item bg-transparent text-light border-0"><i class="bi bi-star-fill text-warning ms-2"></i> هدف، <strong>تشویق معلمان پرتلاش</strong> و الهام‌بخش است.</li>
              <li class="list-group-item bg-transparent text-light border-0"><i class="bi bi-123 text-info ms-2"></i> هر کاربر فقط می‌تواند <strong>حداکثر ۳ رأی</strong> ثبت کند.</li>
              <li class="list-group-item bg-transparent text-light border-0"><i class="bi bi-graph-up-arrow text-primary ms-2"></i> این نتایج صرفاً <strong>آماری و غیررسمی</strong> هستند.</li>
            </ul>
            <div class="text-white text-light small">
              🌟 با رأی‌دادن آگاهانه، فضای انگیزشی برای معلمان خلق کنیم.
            </div>
          </div>
          <div class="modal-footer border-0 justify-content-between px-4 py-3">
            <span class="text-secondary small">سامانه رأی‌دهی معلمان - نسخه آزمایشی</span>
            <button type="button" class="btn btn-outline-light rounded-pill px-4" data-bs-dismiss="modal">بستن</button>
          </div>
        </div>
      </div>
    </div>

    <footer>
      <p>© 2025 سامانه رأی گیری | طراحی شده با ❤️ و django, HTML, CSS</p>
    </footer>
  </div>

<head>
  <style>
    .hidden { display: none; }
    #countdown {
      font-size: 3rem;
      color: #ff0;
      margin-bottom: 1rem;
      font-family: monospace;
    }
    #countdown.ending {
      color: red;
      font-weight: bold;
    }
  </style>
</head>
<body>


<script>
  // زمان پایان از سرور (مثلاً '2025-05-24 23:59:59')
  const endTime = new Date("{{ end_time|date:'Y-m-d H:i:s' }}").getTime();

  function updateCountdown() {
    const now = Date.now();
    let remaining = endTime - now;

    const countdownEl = document.getElementById("countdown");

    if (remaining > 0) {
      const hours = Math.floor(remaining / (1000 * 60 * 60));
      const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((remaining % (1000 * 60)) / 1000);

      // تغییر رنگ در 10 ثانیه آخر
      if (remaining < 10000) {
        countdownEl.classList.add("ending");
      }

      // نمایش دقیق ساعت:دقیقه:ثانیه
      countdownEl.textContent = `${hours.toString().padStart(2,'0')}:${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;

      // آپدیت هر 200 میلی‌ثانیه برای دقت بالا
      setTimeout(updateCountdown, 200);
    } else {
      countdownEl.textContent = "⏰ زمان رأی‌گیری به پایان رسید!";
      document.querySelectorAll(".vote-count").forEach(el => el.classList.remove("hidden"));
      document.getElementById("teacherTable").classList.remove("hidden");
      const voteBtn = document.getElementById("ra");
      if (voteBtn) {
        voteBtn.disabled = true;
        voteBtn.textContent = "رأی‌گیری پایان یافت";
      }
    }
  }

  // شروع تایمر
  updateCountdown();
</script>

  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    function openVoteModal() {
      document.getElementById("voteModal").style.display = "block";
    }

    function closeVoteModal() {
      document.getElementById("voteModal").style.display = "none";
    }

    // بستن مودال با کلیک بیرون از آن
    window.onclick = function(event) {
      const modal = document.getElementById("voteModal");
      if (event.target == modal) {
        modal.style.display = "none";
      }
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
<script>
  document.querySelectorAll('.vote-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      // اجرای فشفشه
      confetti({
        particleCount: 500,
        spread: 200,
        origin: { y: 0.1 },
        colors: ['#fffa00', '#ff0056', '#00ccff', '#00ff00'],
      });

      // همچنین می‌توان یک پیام تبریک هم نمایش داد (اختیاری)
      Toastify({
        text: "معلم ات رو انتخاب کن 🎉",
        duration: 3000,
        gravity: "top",
        position: 'center',
        style: {
          background: "linear-gradient(to right, #00b09b, #96c93d)",
          fontFamily: "Vazirmatn",
        },
      }).showToast();
    });
  });
</script>

{% if messages %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    {% for message in messages %}
      Toastify({
        text: "{{ message }}",
        duration: 3000,
        close: true,
        gravity: "top", // بالا یا پایین صفحه
        position: "right", // راست یا چپ صفحه
        backgroundColor: "{% if message.tags == 'success' %} #4CAF50 {% elif message.tags == 'error' %} #f44336 {% else %} #333 {% endif %}",
        stopOnFocus: true,
      }).showToast();
    {% endfor %}
  });
</script>
{% endif %}

</body>
</html>
